<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="web socket, WebSocket, wsclient, web socket client, lukcad, LukCAD">
    <meta name="author" content="Mikhail Lukyanau">
    <title>WebSocket Client by LUKCAD</title>
    <style>
        body {
            font-family: "Lato", sans-serif;
        }

        .sidenav details {
            color: #f1f1f1;
        }

        .sidenav details summary {
            padding: 4px 4px 0px 0px;
            font-size: 14px;
            color: #cec7c7;
            cursor: pointer;
        }

        .sidenav details summary:hover {
            color: #f1f1f1;

        }

        .sidenav details summary span {
            color: #cac707;
        }

        .sidenav details summary span:hover {
            color: #ddf316;
        }

        .sidenav {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #111;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 10px;
        }

        .sidenav a {
            padding: 4px 4px 4px 16px;
            text-decoration: none;
            font-size: 13px;
            color: #818181;
            display: block;
            transition: 0.3s;
        }

        .sidenav a:hover {
            color: #f1f1f1;
        }

        .sidenav .closebtn {
            position: absolute;
            padding-top: 0px;
            top: 0;
            right: 2px;
            font-size: 34px;
            margin-left: 100px;
        }

        .sidenav .copyright {
            position: absolute;
            padding-top: 8px;
            top: 0;
            left: 8px;
            color: #818181;
            font-size: 20px;
            margin-left: 4px;
        }

        .sidenav p {
            padding: 4px 48px 4px 16px;
            text-decoration: none;
            font-size: 12px;
            color: #ddf316;
            display: block;
            transition: 0.3s;
        }

        .container h4 {
            white-space: nowrap;
            color: green;
        }

        .container {
            margin: 5px;
        }

        .container details {

            margin: 0px;
        }

        .container details summary {
            font-size: 14px;
        }

        .container details p {
            margin: 3px;
            font-size: 12px;
            color: rgb(147, 11, 238);
        }

        .container p {
            margin: 3px;
            font-size: 12px;
        }

        .appnamewithrelease {
            white-space: nowrap;
        }

        .appnamewithrelease>div {
            display: inline-block;
            margin-right: 10px;
        }

        #release {
            display: inline-block;
            background-color: rgb(241, 222, 50);
            color: white;
            padding: 4px 8px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
            display: inline-block;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;            
        }

        #release .ReleasePopup {
            visibility: hidden;
            background-color: #3be42b;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px 0;
            position: absolute;
            z-index: 1;
            top: 125%;
            left: 20%;
            margin-left: -160px;
        }

        #release .ReleasePopup::after {
            content: "";
            position: absolute;
            bottom: 100%;
            left: 75%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent #3be42b transparent;
        }

        #release .show {
            visibility: visible;
            -webkit-animation: fadeIn 1s;
            animation: fadeIn 1s;
        }        

        .newreleasebadge {
            background-color: red;
            color: white;
            padding: 4px 8px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
            display: inline-block;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }



        .newreleasebadge .newReleasePopup {
            visibility: hidden;
            background-color: #cac707;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px 0;
            position: absolute;
            z-index: 1;
            top: 125%;
            left: 20%;
            margin-left: -160px;
        }

        .newreleasebadge .newReleasePopup::after {
            content: "";
            position: absolute;
            bottom: 100%;
            left: 75%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent #cac707 transparent;
        }

        .newreleasebadge .show {
            visibility: visible;
            -webkit-animation: fadeIn 1s;
            animation: fadeIn 1s;
        }

        /* Add animation (fade in the popup) */
        @-webkit-keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        div.topRow {
            width: 100%;
            clear: both;
        }

        div.leftCol {
            width: 50%;
            float: left;
            word-wrap: break-word;
            word-break: break-all;
        }

        div.rightCol {
            width: 50%;
            float: right;
            word-wrap: break-word;
            word-break: break-all;
        }

        input {
            width: 100%;
        }

        textarea {
            width: 100%;
        }

        .btn {
            background-color: DodgerBlue;
            border: none;
            color: white;
            padding: 4px 4px;
            font-size: 12px;
            cursor: pointer;

        }

        .btn:hover {
            background-color: RoyalBlue;
        }

        div.histRow {
            display: table;
            padding: 2px;
            width: 100%;
            font-size: 12px;
        }

        .histText {

            padding: 4px 4px;
            margin: 2px;
            width: 100%;
            display: table-cell;
            background-color: rgb(232, 235, 241);
            cursor: pointer;
        }

        .histText:hover {

            background-color: rgb(179, 199, 240);
        }

        .histBtn {
            cursor: pointer;

            width: auto;
            padding: 4px 4px;
            display: table-cell;
            vertical-align: middle;
            margin: 2px;
        }

        .histBtn:hover {
            background-color: rgb(179, 199, 240);
        }

        div.wshistrow {
            display: table;
            padding: 1px;
            width: 100%;
            font-size: 12px;
            float: right;
        }

        p.wshistname {
            padding-right: 14px;
            margin: 2px;
            width: 100%;
            display: table-cell;
            cursor: pointer;
            color: rgb(179, 199, 240);
            word-break: break-all;
        }

        p.wshistname:hover {

            color: white;
        }

        p.wshistclose {
            cursor: pointer;

            width: auto;
            padding: 4px 4px;
            display: table-cell;
            vertical-align: middle;
            margin: 2px;
        }

        p.wshistclose:hover {
            background: #bbb;
        }

        details.wsproject {
            padding: 0px;
            width: 100%;
            float: right;
        }

        details.wssummary {

            display: table;
            padding: 0px;
            width: 100%;
            float: right;
        }

        div.wsprojectrow {
            display: table-row;
            padding: 0px;
            width: 90%;
            font-size: 12px;
            float: right;
        }

        p.wsprojectname {
            padding-right: 14px;
            margin: 2px;
            width: 100%;
            display: table-cell;
            word-wrap: break-word;
            word-break: break-all;
            cursor: pointer;
        }

        p.wsprojectname:hover {
            background: #2c2c2c;
        }

        p.wsprojectmenu {
            cursor: pointer;

            width: auto;
            padding: 1px;
            display: table-cell;
            vertical-align: middle;
            margin: 2px;

        }

        p.wsprojectmenu:hover {
            background: #bbb;
        }

        #menuWSProjectsActions {
            position: absolute;
            margin: 0;
            z-index: 2;
            padding: 0;
            width: 140px;
            background-color: white;
        }

        #menuWSProjectsActions p {
            height: 18px;
            border: 1px solid black;
            margin: 0;
            padding: 0.5rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #menuWSProjectsActions p:hover {
            background-color: #D3D3D3;
        }

        #menuWSProjectsActions b {
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #ddf316;
            background-color: rgb(99, 87, 87);
        }


        #menuProjectActions {
            position: absolute;
            margin: 0;
            z-index: 2;
            padding: 0;
            width: 140px;
            background-color: white;

        }

        #menuProjectActions p {
            height: 18px;
            border: 1px solid black;
            margin: 0;
            padding: 0.5rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #menuProjectActions p:hover {
            background-color: #D3D3D3;
        }

        #menuProjectActions b {
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #ddf316;
            background-color: rgb(99, 87, 87);
        }

        #menuHistoryActions {
            position: absolute;
            margin: 0;
            z-index: 2;
            padding: 0;
            width: 140px;
            background-color: white;
        }

        #menuHistoryActions p {
            height: 18px;
            border: 1px solid black;
            margin: 0;
            padding: 0.5rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #menuHistoryActions p:hover {
            background-color: #D3D3D3;
        }

        #menuHistoryActions b {
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #ddf316;
            background-color: rgb(99, 87, 87);
        }

        div.paramTopRow {
            width: 100%;
            clear: both;
        }

        .paramRow {
            font-size: 12px;
            display: grid;
            grid-template-columns: 60px 30% auto 35px;
            clear: both;
            gap: 1px;
            background-color: white;
        }

        .paramRow >div {

            text-align: left;
            padding: 1px;
            word-wrap: break-word;
            word-break: break-all;
            background-color: #f1f1f1;
        }

        .wsmodal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        .wsmodal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .wsmodalclose {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .wsmodalclose:hover,
        .wsmodalclose:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }    
        
        .wsconfirmmodal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 99; /* Sit on top */
            padding-top: 90px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        .wsconfirmmodal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 60%;
        }

        .wsalertmodal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 100; /* Sit on top */
            padding-top: 80px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        .wsalertmodal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 70%;
        }        

    </style>
</head>

<body>

    <div id="barSideNav" class="sidenav">
        <b class="copyright">WS LukCAD &copy;</b>
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <details style="padding-top: 24px;">
            <summary title="press right button to open context menu" oncontextmenu="openMenuWSProjectsActions(event)">WS
                projects&nbsp;<span onclick="openMenuWSProjectsActions(event)">&#9783;</span></summary>
            <p>In this group you can choose the previously saved ws-servers and the history messages
                per project.
                Using context menu of name group `WS Project` you can import file with new projects in this group or
                re-import with enrichment existing projects.
            </p>
        </details>
        <div id="listWsProjects"></div>
        <details ontoggle="showHistoryWsServers()">
            <summary title="press right button to open context menu" oncontextmenu="openMenuHistoryActions(event)">
                History WS servers&nbsp;<span onclick="openMenuHistoryActions(event)">&#9783;</span></summary>
            <p>In this group you can choose the previously used web socket servers and the history messages that were
                not combined by Projects.
                Using context menu of name group `History WS serveres` you can import or re-import file with histories
                to enrich existing list.
            </p>
        </details>
        <div id="listWsServersHistory"></div>
    </div>

    <div class="container">

        <div class="appnamewithrelease">
            <div style="cursor:pointer;white-space: nowrap" onclick="openNav()">
                <h4>&#9776; WebSocket Client</h4>
            </div>
            <div id="release" title="About program">v1.0.37</div>
            <div id="newrelease" title="About new release"></div>
        </div>

        <details>
            <summary>WS Project:</summary>
            <p> You can point name of project and your next operations with ws-servers will be saved under name of this
                project. You can find created project by slide menu using icon &#9776;<br>
                <b>Important:</b> Projects will be combined if they have the same <b>generated key</b>. For example: project
                'Project 1' and 'Project1' will have the same key <b>'Project1_'</b>.
            </p>
        </details>
        <input type="text" id="nameProject" onchange="changeProject()" /> </br>
        <details>
            <summary>WS Server to interact with messages:</summary>
            <p>You should point here your ws-server manually or choose it from group 'WS Projects' by left slide
                menu by opening icon &#9776;
                When you enter new ws-server manually you have to use button 'Reconnect' to be able strart connection to
                pointed server. </p>
        </details>
        <input type="text" id="nameServer" value="wss://echo.websocket.org" /> </br>
        <details>
            <summary>WS Parameters:</summary>
            <p>You can point the necessary 'query' parameters that should be applied to ws-server when you create connect to it. For example: for token
                authentication you maybe needing to add parameter 'token' with required value. Also you can add 'head' parameters 'Sec-WebSocket-Protocol' that let point to WS server which algorithm to use for message execution.</p>
        </details>

        <div class="paramTopRow"></div>
        <div class="paramRow">
            <div style="background-color: dimgray;color: white;" >Type:</div>
            <div style="background-color: dimgray;color: white;">Name parameter:</div>
            <div style="background-color: dimgray;color: white;">Value parameter:</div>
            <div style="background-color: dimgray;color: white;"></div>
        </div>
        <div id="queryList" class="paramRow"></div>
        <div id="headList" class="paramRow"></div>
        <div class="paramRow">
            <div>
                <select id="typeNewParameter" onchange="changeParamInput(event)">
                    <option value="query" >query</option>
                    <option value="head" >head</option>
                </select>
            </div>
            <div>
                <input type="text" id="nameNewParameter" value="" />
            </div>
            <div>
                <input type="text" id="valueNewParameter" value="" />
            </div>
            <div>
                <button class="btn" style="width: 100%;" title="Add parameter to this ws-server" onclick="addParameters()">Add</button>
            </div>
        </div>
        <div class="paramTopRow"></div>

        <details>
            <summary>Message:</summary>
            <p>You should enter text message or json message and press 'Send' button to send message to ws-server.
                Notice:
                if previously you didn't connect to pointed ws-server you should do it by using button 'Reconnect'.</p>
        </details>
        <textarea rows="4" id="messageInput"></textarea></br>
        <button class="btn" onclick="sendMessage()">Send</button>
        <button class="btn" onclick="closeConnect()">Disconnect</button>
        <button class="btn" onclick="reConnect()">Reconnect</button>
        <button class="btn" onclick="clearScreen()">Clean Messages</button>

        <!--Action menu for WS Porjects title. Hidden and appear only by right click-->
        <div id="menuWSProjectsActions" class="dropdownmenu" style="display: none;">
            <b id="namemenuWSProjectsActions"></b>
            <p id="createWSProject" onclick="clickMenuItemOnWSProjectsActions(event)">Create project</p>
            <p id="importWSProjects" onclick="clickMenuItemOnWSProjectsActions(event)">Import project</p>
            <p id="closeWSProjectsMenu" onclick="clickMenuItemOnWSProjectsActions(event)">Close menu</p>
        </div>

        <!--Action menu for porjects. Hidden and appear only by right click-->
        <div id="menuProjectActions" class="dropdownmenu" style="display: none;">
            <b id="namemenuProjectActions"></b>
            <p id="addWStoProject" onclick="clickMenuItemOnProjectActions(event)">Add ws-server</p>
            <p id="renameProject" onclick="clickMenuItemOnProjectActions(event)">Re-name project</p>            
            <p id="exportProject" onclick="clickMenuItemOnProjectActions(event)">Export project</p>
            <p id="removeProject" onclick="clickMenuItemOnProjectActions(event)">Remove project</p>
            <p id="closeProjectMenu" onclick="clickMenuItemOnProjectActions(event)">Close menu</p>
        </div>

        <!--Action menu for history. Hidden and appear only by right click-->
        <div id="menuHistoryActions" class="dropdownmenu" style="display: none;">
            <b id="namemenuHistoryActions"></b>
            <p id="exportHistory" onclick="clickMenuItemOnHistoryActions(event)">Export history</p>
            <p id="importHistory" onclick="clickMenuItemOnHistoryActions(event)">Import history</p>
            <p id="closeHistoryMenu" onclick="clickMenuItemOnHistoryActions(event)">Close menu</p>
        </div>

        <!-- hidden button to use for import projects for choosing files-->
        <input type="file" id="projectimportfiles" onchange="readImportedProjectText(this)" name="files[]" hidden="true"
            multiple />
        <!-- hidden button to use for import history for choosing files-->
        <input type="file" id="historyimportfiles" onchange="readImportedHistoryText(this)" name="files[]" hidden="true"
            multiple />

        <div class="main">
            <div class="topRow"></div>
            <div class="leftCol">
                <details>
                    <summary>Messages:</summary>
                    <p>This panal expose your requests and responses betwen your client and WS server. Errored messages
                        have red colour.</p>
                </details>
            </div>
            <div class="rightCol">
                <details>
                    <summary>History of sending unique messages:</summary>
                    <p>This panel has list of wunique messages that were successfuly sent to ws server. If you press any
                        message the value of message will be inserted to Message box and you can resend it again.</p>
                </details>
            </div>
            <div>
                <div class="main">
                    <div class="topRow"></div>
                    <div id="output" class="leftCol"></div>
                    <div id="history" class="rightCol"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- The Modal dialog to change Name of Project-->
    <div id="wsChangeProjectProjectModal" class="wsmodal">
        <!-- Name change of Project Modal content -->
        <div class="wsmodal-content">
            <span id="closeChangeProjectModal" class="wsmodalclose">&times;</span>
            <p>Old project name:</p>
            <input id="wsModalinp1" type="text"></input>
            <p>New project name:</p>
            <input id="wsModalinp2" type="text"></input>  
            <p></p>
            <button id="modifyname" onclick="changeProjectName(event)" >Change</button>
        </div>
    </div>   
    
    <!-- The Modal dialog to create Project Name-->
    <div id="wsCreateProjectProjectModal" class="wsmodal">
        <!-- Name change of Project Modal content -->
        <div class="wsmodal-content">
            <span id="closeCreateProjectModal" class="wsmodalclose">&times;</span>
            <p>Project name:</p>
            <input id="wsModalinp3" type="text"></input>
            <p></p>
            <button id="createname" onclick="createProjectName(event)" >Create</button>
        </div>
    </div>    
    
    <!-- The Modal dialog to add WS server to Project-->
    <div id="wsAddWSServerProjectModal" class="wsmodal">
        <!-- Name change of Project Modal content -->
        <div class="wsmodal-content">
            <span id="closeAddWSServerProjectModal" class="wsmodalclose">&times;</span>
            <details>
                <summary>WS-server URL:</summary>
                <p>The URL should start from 'ws://' or 'wss://' and URL without query parameters will go to name of ws-server
                    Query parameters will be extracted and added into ws-server into 'WS Parameters' list.
                </p>
            </details>
            <input id="wsModalinp4" type="text"></input>
            <p></p>
            <button id="addwsservertoproject" onclick="addWsServerToProject(event)" >Add</button>
        </div>
    </div>  
    
    <!-- The Modal dialog wsConfirm to be used instead of standard confirm-->
    <div id="wsConfirmDialogModal" class="wsconfirmmodal">
        <!-- Name change of Project Modal content -->
        <div class="wsconfirmmodal-content">
            <p id="wsconfirmtext"></p>
            <p></p>
            <button id="wsconfirmyes">Yes</button>
            <button id="wsconfirmno">No</button>
        </div>
    </div>   
    
    <!-- The Modal dialog wsAlert to be used instead of standard alert-->
    <div id="wsAlertDialogModal" class="wsalertmodal">
        <!-- Name change of Project Modal content -->
        <div class="wsalertmodal-content">
            <span id="wsalerttext"></span>
            <p></p>
            <button id="wsalertok" onclick="wsalertclick(event)">Ok</button>
        </div>
    </div>  

    <script>



        function changeParamInput(event) {
            if (event.target.value === 'head') {
                document.getElementById('nameNewParameter').value  = 'Sec-WebSocket-Protocol';
                document.getElementById('nameNewParameter').disabled = true;
            } else {
                document.getElementById('nameNewParameter').value  = '';
                document.getElementById('nameNewParameter').disabled = false;
            }
        }

        // slide menu width
        var slideMenuWidth = 250;

        // create client to be able check new version of wsclient
        var HttpClient = function () {
            this.get = function (aUrl, aCallback) {
                var anHttpRequest = new XMLHttpRequest();
                anHttpRequest.onreadystatechange = function () {
                    if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                        aCallback(anHttpRequest.responseText);
                }

                anHttpRequest.open("GET", aUrl, true);
                anHttpRequest.send(null);
            }
        }

        var maxRelease = '';

        var client = new HttpClient();
        client.get('https://api.github.com/repos/lukcad/wsclient/releases', function (response) {

            // read info about releases of wslclient
            try {
                var respObj = JSON.parse(response) ?? [];
                for (let index = 0; index < respObj.length; index++) {
                    var releasename = respObj[index].name;
                    if (releasename > maxRelease) {
                        maxRelease = releasename;
                    }
                }
                console.log(maxRelease);
                var curRelease = document.getElementById("release").innerHTML ?? '';
                if (maxRelease !== '') {
                    if (maxRelease > curRelease) {

                        var newReleasePopup = document.createElement("span");
                        newReleasePopup.id = "newReleasePopup";
                        newReleasePopup.className = "newReleasePopup";
                        newReleasePopup.innerHTML = `There is <a href='https://github.com/lukcad/wsclient/releases'>new release</a> version ${maxRelease} <br> you can download it here: <br> <a href='https://github.com/lukcad/wsclient/archive/refs/tags/${maxRelease}.zip' >Release ${maxRelease}</a><br> or pull latest version from <br> <a href='https://github.com/lukcad/wsclient/archive/refs/heads/main.zip' >Download zip</a><br> <br>or pull main branch <br> from <a href='https://github.com/lukcad/wsclient'>gitHub</a><br>or clone by command: <h6>&nbsp;git clone https://github.com/lukcad/wsclient.git&nbsp;</h6>Copyright &copy; LukCAD 1992-2025`;

                        var newRelease = document.getElementById("newrelease");
                        newRelease.className = "newreleasebadge";
                        newRelease.onclick = toogleNewReleasePopup;
                        newRelease.innerHTML = 'New';
                        newRelease.appendChild(newReleasePopup);

                        function toogleNewReleasePopup() {
                            var popup = document.getElementById("newReleasePopup");
                            popup.classList.toggle("show");
                        }

                    }
                }
            } catch (error) {
                console.log('error to read version from gitHub project...');
            }

        });

        // prepare information about program (when press number version on MAIN WORKING AREA)

        var ReleasePopup = document.createElement("span");
        ReleasePopup.id = "ReleasePopup";
        ReleasePopup.className = "ReleasePopup";
        ReleasePopup.innerHTML = `ABOUT:<br><br> WebSocket client to test<br>and keep test projects<br>with messages and servers<br><a href='https://github.com/lukcad/wsclient/wiki/WebSocket-client'>WIKI PAGE</a><br>Latest commit of release<br> you can get from <br> <a href='https://github.com/lukcad/wsclient/archive/refs/heads/main.zip' >Download zip</a><br> or pull main branch <br> from <a href='https://github.com/lukcad/wsclient'>gitHub</a><br>or clone by command: <h6>&nbsp;git clone https://github.com/lukcad/wsclient.git&nbsp;</h6>Copyright &copy; LukCAD 1992-2025 `;

        var Release = document.getElementById("release");
        Release.onclick = toogleReleasePopup;
        Release.appendChild(ReleasePopup);

        function toogleReleasePopup() {
            var popup = document.getElementById("ReleasePopup");
            popup.classList.toggle("show");
        }        

        // Create a WebSocket instance
        // and connect to the server
        var socket;
        var wsUri;
        var wsUriClosing;
        var wsProjectId;
        var wsProjectName;

        initProjectNameAndId();

        // modal dialog to organize custom alert instead of standard
        function wsAlert(_wsalerttext) {

            // Get the modal
            var modal = document.getElementById("wsAlertDialogModal");

            // Set confirm text
            document.getElementById("wsalerttext").innerHTML = _wsalerttext ?? '';

            // open modal
            modal.style.display = "block";  

            wsalertclick = function(event) {
                modal.style.display = "none";
            }


        }

        // modal diallog to organize custom confirm instead of standard
        // way to use: 
        //   1) function which uses it should be async 
        //   2) getting result should use pattern:
        //      var result = await wsConfirm('Some test message');
        function wsConfirm(_wsconfirmtext) {
            return new Promise((resolve, reject) => {

            // Get the modal
            var modal = document.getElementById("wsConfirmDialogModal");

            // Set confirm text
            document.getElementById("wsconfirmtext").innerHTML = _wsconfirmtext ?? '';

            // open modal
            modal.style.display = "block";                
            
                wsconfirmyes.onclick = function() {
                    modal.style.display = "none";
                    resolve(true);
                    //callback(true);
                }

                wsconfirmno.onclick = function() {
                    modal.style.display = "none";
                    resolve(false);
                    //callback(false);
                }
            });
            
        }

        // modal diallog to add ws-server to project
        function modDialogWsAddWSserverToProject(_wsprojectname){

                        // Get the modal
            var modal = document.getElementById("wsAddWSServerProjectModal");

            // Get the <span> element that closes the modal
            var span = document.getElementById("closeAddWSServerProjectModal");

            // open modal
            modal.style.display = "block";
            
            // When the user clicks on <span> (x), close the modal
            span.onclick = function() {
                modal.style.display = "none";
            }  

            addWsServerToProject = function(event) {
                var _wsserver = document.getElementById("wsModalinp4").value.trim();

                if (_wsserver !== ''){

                    if ((_wsserver.startsWith('ws://')) || (_wsserver.startsWith('wss://')) ){

                        var _wsparams = '';

                        if (_wsserver.includes('?')){
                            _wsparams = _wsserver.split('?')[1].trim();
                            _wsserver = _wsserver.split('?')[0].trim();
                        }

                        if (isWSServerAdded(_wsprojectname, _wsserver) === false) {

                            // add new ws-server to project
                            addWSserver(_wsprojectname, _wsserver);

                            // add parameters to new ws-server of project
                            if (_wsparams.includes('&')){
                                // adding many parameters
                                var arrparams = _wsparams.split('&');
                                arrparams.forEach(_wsparam => {
                                    if (_wsparam.includes('=')) {
                                        addWSParameter(_wsprojectname, _wsserver, 'query', _wsparam.split('=')[0], _wsparam.split('=')[1] ?? '');
                                    }
                                    
                                });
                            } else {
                                // adding one parameter
                                var _wsparam = _wsparams;
                                if (_wsparam.includes('=')) {
                                    addWSParameter(_wsprojectname, _wsserver, 'query', _wsparam.split('=')[0], _wsparam.split('=')[1] ?? '');
                                }
                            }                            

                            modal.style.display = "none";
                            
                        } else {
                            wsAlert(`This ws-server URL "${_wsserver}" was added previously.\n Please change the ws-server URL and try again!`);
                        }                        

                    } else {
                        wsAlert(`This ws-server URL "${_wsserver}" should start from\n 'wss://' or 'ws://'.\n Please change the ws-server URL and try again!`);
                    }

                } else {
                    wsAlert('Empty ws-server URL can not be added. \n Please change the ws-server URL and try again!');
                }
            }

        }

        // modal dialog to create project name
        function modDialogWsCreateProjectName(){

            // Get the modal
            var modal = document.getElementById("wsCreateProjectProjectModal");

            // Get the <span> element that closes the modal
            var span = document.getElementById("closeCreateProjectModal");

            // open modal
            modal.style.display = "block";
            
            // When the user clicks on <span> (x), close the modal
            span.onclick = function() {
                modal.style.display = "none";
            }            

            createProjectName = function(event) {
                var _wsprojectnamenew = document.getElementById("wsModalinp3").value.trim();
                

                if (_wsprojectnamenew !== ''){
                    var _wsprojectnameexisting = findExistingProjectName(_wsprojectnamenew);
                    if (_wsprojectnameexisting === '') {

                        // add new name of project to `wsprojects` and correct name if during add the proposed name has been changed.
                        addProjectName(_wsprojectnamenew);
                        reloadProjects();
                        modal.style.display = "none";
                        
                     } else {
                            wsAlert(`This project name can not be cretated.\n Because it generates the same key\n which is based on exisiting name or reserved word\n "${_wsprojectnameexisting}"\n Please change the project name and try again!`);
                        }

                } else {
                    wsAlert('The project can not be created with empty name. \n Change name and try again!');
                }
            }

        }

        // modal dialog to change project name
        function modDialogWsChangeProjectName(_wsprojectname) {

            // Get the modal
            var modal = document.getElementById("wsChangeProjectProjectModal");

            // Get the <span> element that closes the modal
            var span = document.getElementById("closeChangeProjectModal");

            // open modal
            modal.style.display = "block";
            
            // When the user clicks on <span> (x), close the modal
            span.onclick = function() {
                modal.style.display = "none";
            }

            // business: read existing text from _idtochange
            document.getElementById("wsModalinp1").value = _wsprojectname;
            document.getElementById("wsModalinp1").disabled = true;
            
            // business: read new name and save to _idtochange
            changeProjectName = async function(event) {
                var _wsprojectnamenew = document.getElementById("wsModalinp2").value.trim();
                

                if (_wsprojectnamenew !== ''){
                    var _wsprojectnameexisting = findExistingProjectName(_wsprojectnamenew);
                    if (_wsprojectnameexisting === '') {
                        // we ready to rename here and ask last times
                        var result = await wsConfirm(`Want to rename WS project: "${_wsprojectname}" to new name "${_wsprojectnamenew}" ? `);
                        if (result) {
                            var _projectid = convertProjectNameToId(_wsprojectname);
                            var _projectidnew = convertProjectNameToId(_wsprojectnamenew);
                            var _arrKeysToRemove = [];

                            for (let i = 0; i < localStorage.length; i++) {
                                var _key = localStorage.key( i );
                                if (_key.startsWith(_projectid)) {
                                    var _newkey = _key.replace(_projectid, _projectidnew);
                                    var _tmp = localStorage.getItem(_key) ?? '';
                                    if (_tmp !== ''){
                                        localStorage.setItem(_newkey, _tmp);
                                        
                                    }
                                    _arrKeysToRemove.push(_key);
                                }
                                
                            }

                            _arrKeysToRemove.forEach(_oldkey => {
                                localStorage.removeItem(_oldkey);
                            });

                            var _listprojects = localStorage.getItem('wsmsprojects') ?? '';
                            if (_listprojects !== ''){
                                var _wsprojectnameexact = '"' + _wsprojectname + '"';
                                var _wsprojectnamenewexact = '"' + _wsprojectnamenew + '"';
                                _listprojects = _listprojects.replace(`${_wsprojectnameexact}`, `${_wsprojectnamenewexact}`);
                                localStorage.setItem('wsmsprojects', _listprojects);
                            }


                            var renameactiveproject = false;
                            if (_wsprojectname === wsProjectName) {
                                document.getElementById("nameProject").value = _wsprojectnamenew;
                                localStorage.setItem('wsmsprojectactive', _wsprojectnamenew);
                            }
                            setProjectId();
                            setArrHistory();
                            reloadHistory();
                            setArrProjects();
                            setArrWSservers();
                            reloadProjects();
                            reloaNav();
                            reloadQueries();
                            reloadHeads();
                            
                        
                            modal.style.display = "none";
                        } 
                    } else {
                            wsAlert(` New project name can not be assigned.\n Because it generates the same key\n which is based on exisiting name or reserved word\n "${_wsprojectnameexisting}"\n Please change new project name!`);
                        }

                } else {
                    wsAlert('New project name can not be empty. \n Change name and try again!');
                }

            }
        }

        // list projects in left side menu `WS projects`
        var arrProjects = [];

        function setArrProjects() {
            arrProjects = [];
            var json_projects_str = '[]';
            if (localStorage.getItem("wsmsprojects") !== null) {
                if (localStorage.getItem("wsmsprojects") !== '') {
                    json_projects_str = localStorage.getItem("wsmsprojects");
                }
            }
            var arrProjectsraw = JSON.parse(json_projects_str);

            for (let index = 0; index < arrProjectsraw.length; index++) {
                const element = arrProjectsraw[index];
                if (element !== null) {
                    arrProjects.push(element);
                }
            }
        }

        // array for history WS servers
        var arrNav;

        function setArrWSservers() {
            arrNav = [];
            var json_srv_str = '[]';
            if (localStorage.getItem(`${wsProjectId}wsmsservers`) !== null) {
                if (localStorage.getItem(`${wsProjectId}wsmsservers`) !== '') {
                    json_srv_str = localStorage.getItem(`${wsProjectId}wsmsservers`);
                }
            }

            var arrnavraw = JSON.parse(json_srv_str);


            for (let index = 0; index < arrnavraw.length; index++) {
                const element = arrnavraw[index];
                if (element !== null) {
                    arrNav.push(element);
                }
            }
        }

        function addWSserver(_projectname, _wsserver) {
            var _wsProjectId = convertProjectNameToId(_projectname) ?? '';
            var _arrNav = [];
            var json_srv_str = '[]';
            if (localStorage.getItem(`${_wsProjectId}wsmsservers`) !== null) {
                if (localStorage.getItem(`${_wsProjectId}wsmsservers`) !== '') {
                    json_srv_str = localStorage.getItem(`${_wsProjectId}wsmsservers`);
                }
            }

            var arrnavraw = JSON.parse(json_srv_str);

            if (arrnavraw.indexOf(_wsserver) < 0) {
                arrnavraw.push(_wsserver);
                var json_nav_str = JSON.stringify(arrnavraw);
                localStorage.setItem(`${_wsProjectId}wsmsservers`, json_nav_str);
                reloaNavBy(_projectname, arrnavraw);
            }
        }

        function isWSServerAdded(_projectname, _wsserver) {
            var isadded = false;
            var _wsProjectId = convertProjectNameToId(_projectname) ?? '';
            var _arrNav = [];
            var json_srv_str = '[]';
            if (localStorage.getItem(`${_wsProjectId}wsmsservers`) !== null) {
                if (localStorage.getItem(`${_wsProjectId}wsmsservers`) !== '') {
                    json_srv_str = localStorage.getItem(`${_wsProjectId}wsmsservers`);
                }
            }

            var arrnavraw = JSON.parse(json_srv_str);

            if (arrnavraw.indexOf(_wsserver) >= 0) {
                isadded = true;
            }
            return isadded;
        }

        function getArrWSserversBy(_wsProjectId) {
            _arrNav = [];

            var json_srv_str = '[]';
            if (localStorage.getItem(`${_wsProjectId}wsmsservers`) !== null) {
                if (localStorage.getItem(`${_wsProjectId}wsmsservers`) !== '') {
                    json_srv_str = localStorage.getItem(`${_wsProjectId}wsmsservers`);
                }
            }

            var arrnavraw = JSON.parse(json_srv_str);

            for (let index = 0; index < arrnavraw.length; index++) {
                const element = arrnavraw[index];
                if (element !== null) {
                    _arrNav.push(element);
                }
            }
            return _arrNav;
        }

        // array for history messages
        var arr;

        function setArrHistory() {
            arr = [];

            var json_str = '[]';
            if (localStorage.getItem(`${wsProjectId}wsmshistory`) !== null) {
                if (localStorage.getItem(`${wsProjectId}wsmshistory`) !== '') {
                    json_str = localStorage.getItem(`${wsProjectId}wsmshistory`);
                }
            }

            var arrraw = JSON.parse(json_str);


            for (let index = 0; index < arrraw.length; index++) {
                const element = arrraw[index];
                if (element !== null) {
                    arr.push(element);
                }
            }
        }

        function showHistoryWsServers() {
            var _wsproject = '';
            var _wsProjectId = convertProjectNameToId(_wsproject);
            var _arrNav = getArrWSserversBy(_wsProjectId) ?? [];
            reloaNavBy(_wsproject, _arrNav);
        }

        function getarrProjectsWithProjectID(_filterbyid) {
            var _arrprojectswithid = [];
            var _arrprojects = [];
            var _listwsmsprojects = localStorage.getItem('wsmsprojects');
            if (_listwsmsprojects !== null){
                if ((_listwsmsprojects !== '') & (_listwsmsprojects.includes('[')) & (_listwsmsprojects.includes(']'))){
                    _arrprojects = JSON.parse(_listwsmsprojects) ?? [];
                    _arrprojects.forEach(_prj => {
                        var _prjwithid = `${convertProjectNameToId(_prj)}::${_prj}`;
                        if ((_filterbyid ?? '') === '') {
                            _arrprojectswithid.push(_prjwithid);  
                        } else {
                            if ((_filterbyid) === convertProjectNameToId(_prj)) {
                                _arrprojectswithid.push(_prjwithid);
                            }
                        }
                        
                    });
                }
            }
            return _arrprojectswithid;
        }

        function convertToExistingProjectName(_wsprojectname){
            var _wsProjectId = convertProjectNameToId(_wsprojectname);
            var arrProjectsWithId = getarrProjectsWithProjectID(_wsProjectId);
            if (arrProjectsWithId.length > 0){
                if (arrProjectsWithId[0].includes('::')){
                    var _wsprojectnameexisting = arrProjectsWithId[0].split('::')[1];
                    if (_wsprojectnameexisting !== _wsprojectname){
                        _wsprojectname = _wsprojectnameexisting;
                        document.getElementById("nameProject").value  = _wsprojectname;
                    }
                }
                
            }            
            
            return _wsprojectname;
        }

        function findExistingProjectName(_wsprojectname){
            var _wsProjectId = convertProjectNameToId(_wsprojectname);
            var arrProjectsWithId = getarrProjectsWithProjectID(_wsProjectId);
            if (arrProjectsWithId.length > 0){
                if (arrProjectsWithId[0].includes('::')){
                    var _wsprojectnameexisting = arrProjectsWithId[0].split('::')[1];
                    if (_wsprojectnameexisting !== ''){
                        return _wsprojectnameexisting;
                    }
                }
                
            }            
            
            return '';
        }        

        function setProjectId() {

            var _wsprojectname = (document.getElementById("nameProject").value ?? '').trim();
            wsProjectId = convertProjectNameToId(_wsprojectname);
            if (_wsprojectname !== '') {
                wsProjectName = convertToExistingProjectName(_wsprojectname);
            }
            localStorage.setItem("wsmsprojectactive", wsProjectName);

        }

        function addProjectName(_wsProjectName) {

            var _wsProjectNameAdded = '';
            if (_wsProjectName !== '') {
                var _wsProjectExist = findExistingProjectName(_wsProjectName);
                var _wsProjectId = convertProjectNameToId(_wsProjectExist);
                if (_wsProjectId === ''){
                    _wsProjectNameAdded = _wsProjectName;
                    if (arrProjects.indexOf(_wsProjectName) < 0) {
                        arrProjects.push(_wsProjectName);
                        var json_prj_str = JSON.stringify(arrProjects);
                        localStorage.setItem("wsmsprojects", json_prj_str);
                    }
                } else {
                    var _arrwsProjects = getarrProjectsWithProjectID(_wsProjectId);
                    _wsProjectNameAdded = _arrwsProjects.split('::')[1] ?? '';
                }
            } else {
                _wsProjectNameAdded = '';
            }
            return _wsProjectNameAdded;
        }

        function convertProjectNameToId(wsprojectname) {
            var _wsProjectId = `${wsprojectname.replace(/[^A-Za-z0-9]/g, '')}`;
            return (_wsProjectId !== '') ? `${_wsProjectId}_` : '';
        }

        function convertWsServerNameToId(_wsserver) {
            _wsserver = _wsserver.trim();
            var _wsserverId = `${_wsserver.replace(/[^A-Za-z0-9]/g, '')}`;
            return _wsserverId;
        }

        function initProjectNameAndId() {
            wsProjectName = '';
            if (localStorage.getItem("wsmsprojectactive") !== null) {
                wsProjectName = localStorage.getItem("wsmsprojectactive");
            }

            document.getElementById('nameProject').value = wsProjectName;
            setProjectId();
        }

        function initInputOfWeServer() {

            wsUri = 'wss://echo.websocket.org';

            if (localStorage.getItem("wsmsserveractive") !== null) {
                wsUri = localStorage.getItem("wsmsserveractive");
            }

            document.getElementById('nameServer').value = wsUri;
        }

        function closeDropDownLists(exceptmenuwithid) {
            // close other elements with class "dropdownmenu"
            var dropdownmenues = document.getElementsByClassName("dropdownmenu");
            for (let index = 0; index < dropdownmenues.length; index++) {
                const element_menu = dropdownmenues[index];
                if (exceptmenuwithid !== element_menu) {
                    element_menu.style.display = "none";
                }

            }
        }

        function openMenuWSProjectsActions(e) {

            e.preventDefault();

            var menu = document.getElementById("menuWSProjectsActions");

            // close other elements with class "dropdownmenu"
            closeDropDownLists(menu.id);

            // write title of menu
            document.getElementById("namemenuWSProjectsActions").innerHTML = 'WS Projects';

            // show 'context menu'
            if (e.pageX > (slideMenuWidth - 140))
            {
                menu.style.left = (slideMenuWidth - 140) + "px";
            } else {
                menu.style.left = e.pageX + "px";
            }
            menu.style.top = e.pageY + "px";
            menu.style.display = "block";
        }

        function clickMenuItemOnWSProjectsActions(et) {
            // do operations according to context menu here:

            var actionName = et.target.id;

            if (actionName === 'createWSProject') {
                // add new project
                modDialogWsCreateProjectName();
            }            

            if (actionName === 'importWSProjects') {
                if (document.getElementById('projectimportfiles') !== null) {
                    document.getElementById('projectimportfiles').value = null;
                    document.getElementById('projectimportfiles').click();
                }
            }


            if (actionName === 'closeWSProjectsMenu') {
                // do nothing, because next code close this menu
            }

            // hide 'context menu'
            et.target.parentElement.style.display = "none";
        }

        async function clickMenuItemOnProjectActions(et) {
            // do operations according to context menu here:
            var _wsprojectname = et.target.title;
            var _wsprojectid = convertProjectNameToId(_wsprojectname) ?? '';
            var actionName = et.target.id;

            if (actionName === 'addWStoProject') {

                modDialogWsAddWSserverToProject(`${_wsprojectname}`);
            }

            if (actionName === 'renameProject') {

                modDialogWsChangeProjectName(`${_wsprojectname}`);

            }

            if (actionName === 'exportProject') {
                // here we create dynamically file and save it
                var link = document.createElement("a");
                var _listwsmsservers = `${localStorage.getItem(`${_wsprojectid}wsmsservers`)}`;
                var _listwsmshistory = `${localStorage.getItem(`${_wsprojectid}wsmshistory`)}`;

                // add main content
                var content = `projectname:${_wsprojectname}\n`
                    + `projectid:${_wsprojectid}\n`
                    + `${_wsprojectid}wsmsservers:${_listwsmsservers}\n`
                    + `${_wsprojectid}wsmshistory:${_listwsmshistory}\n`;

                try {
                    // try to add to content query parameters
                    var _arrwsmsservers = JSON.parse(_listwsmsservers);
                    _arrwsmsservers.forEach(_wsserver => {
                        var _keywsparameters = getKeyWSParameters(_wsprojectname, _wsserver, 'query') ?? '';
                        if (_keywsparameters !== '') {
                            var _listwsmsparameters = localStorage.getItem(`${_keywsparameters}`);
                            if (_listwsmsparameters !== null) {
                                content = content + `${_keywsparameters}:${_listwsmsparameters}\n`;
                            }
                            
                        }
                        
                    });

                    // try to add to content head parameters
                    _arrwsmsservers.forEach(_wsserver => {
                        var _keywsparameters = getKeyWSParameters(_wsprojectname, _wsserver, 'head') ?? '';
                        if (_keywsparameters !== '') {
                            var _listwsmsparameters = localStorage.getItem(`${_keywsparameters}`);
                            if (_listwsmsparameters !== null) {
                                content = content + `${_keywsparameters}:${_listwsmsparameters}\n`;
                            }
                            
                        }
                        
                    });
                    
                } catch (error) {
                    
                }

                const file = new Blob([content], { type: 'text/plain' });
                link.href = URL.createObjectURL(file);
                link.download = `${_wsprojectid}.wsclient`;
                link.click();
                URL.revokeObjectURL(link.href);
            }

            if (actionName === 'removeProject') {
                var result = await wsConfirm(`Want to delete WS project: "${_wsprojectname}" ? Message history and WS servers of project will be deleted as well.`);
                if (result) {
                    var deleteactivews = false;
                    if (_wsprojectname === wsProjectName) {
                        console.log('delete active');
                        deleteactivews = true;
                        //closeConnect();
                    }
                    if (arrProjects.indexOf(_wsprojectname) >= 0) {
                        var indextoremove = arrProjects.indexOf(_wsprojectname);
                        var newarrprojects = [];
                        for (let index = 0; index < arrProjects.length; index++) {

                            if (index !== indextoremove) {
                                if (arrProjects[index] !== null) {
                                    newarrprojects.push(arrProjects[index]);
                                }
                            }
                        }
                        arrProjects = newarrprojects;

                        var json_projects_str = JSON.stringify(arrProjects);
                        localStorage.setItem("wsmsprojects", json_projects_str);

                        if (_wsprojectid !== '') {
                            if (localStorage.getItem(`${_wsprojectid}wsmsservers`) !== null) {
                                try {
                                    var _listwsmsservers = localStorage.getItem(`${_wsprojectid}wsmsservers`) ?? '[]';
                                    var _arrwsmsserver = JSON.parse(_listwsmsservers);
                                    array.forEach(_wsmsserver => {
                                        deleteWSParameters(_wsprojectname, _wsmsserver, 'query');
                                        deleteWSParameters(_wsprojectname, _wsmsserver, 'head');
                                    });

                                } catch (error) {
                                    
                                }
                                
                                
                                localStorage.removeItem(`${_wsprojectid}wsmsservers`);
                            }
                            if (localStorage.getItem(`${_wsprojectid}wsmshistory`) !== null) {
                                localStorage.removeItem(`${_wsprojectid}wsmshistory`);
                            }
                        }

                        if (document.getElementById(_wsprojectid) !== null) {
                            var _removeelement = document.getElementById(_wsprojectid);
                            _removeelement.remove();
                        }

                        if (deleteactivews) {

                            document.getElementById("nameProject").value = '';
                            wsProjectName = '';
                            setProjectId();
                            setArrHistory();
                            reloadHistory();
                            setArrWSservers();
                            reloadProjects();
                            reloaNav();

                        }

                        // close left slide menu
                        closeNav();
                    }
                }
            }


            if (actionName === 'closeProjectMenu') {
                // do nothing, because next code close this menu
            }

            // hide 'context menu'
            et.target.parentElement.style.display = "none";
        }

        function openMenuHistoryActions(e) {

            e.preventDefault();

            var menu = document.getElementById("menuHistoryActions");

            // close other elements with class "dropdownmenu"
            closeDropDownLists(menu.id);

            // write title of menu
            document.getElementById("namemenuHistoryActions").innerHTML = 'History WS servers';

            // show 'context menu'
            if (e.pageX > (slideMenuWidth - 140))
            {
                menu.style.left = (slideMenuWidth - 140) + "px";
            } else {
                menu.style.left = e.pageX + "px";
            }
            menu.style.top = e.pageY + "px";
            menu.style.display = "block";
        }

        function clickMenuItemOnHistoryActions(et) {
            // do operations according to context menu here:
            var _wsprojectname = '';
            var _wsprojectid = '';
            var actionName = et.target.id;

            if (actionName === 'exportHistory') {
                // here we create dynamically file and save it
                var link = document.createElement("a");
                var _listwsmsservers = `${localStorage.getItem(`${_wsprojectid}wsmsservers`)}`;
                var _listwsmshistory = `${localStorage.getItem(`${_wsprojectid}wsmshistory`)}`;

                // add main content
                var content = `projectname:${_wsprojectname}\n`
                    + `projectid:${_wsprojectid}\n`
                    + `${_wsprojectid}wsmsservers:${_listwsmsservers}\n`
                    + `${_wsprojectid}wsmshistory:${_listwsmshistory}\n`;

                try {
                    // try to add to content specific parameters
                    var _arrwsmsservers = JSON.parse(_listwsmsservers);
                    _arrwsmsservers.forEach(_wsserver => {
                        var _keywsparameters = getKeyWSParameters(_wsprojectname, _wsserver, 'query') ?? '';
                        if (_keywsparameters !== '') {
                            var _listwsmsparameters = localStorage.getItem(`${_keywsparameters}`);
                            if (_listwsmsparameters !== null) {
                                content = content + `${_keywsparameters}:${_listwsmsparameters}\n`;
                            }
                            
                        }
                    });
                    
                } catch (error) {
                    
                }                    
                const file = new Blob([content], { type: 'text/plain' });
                link.href = URL.createObjectURL(file);
                link.download = `wshistory_.wsclient`;
                link.click();
                URL.revokeObjectURL(link.href);
            }

            if (actionName === 'importHistory') {
                if (document.getElementById('historyimportfiles') !== null) {
                    document.getElementById('historyimportfiles').value = null;
                    document.getElementById('historyimportfiles').click();
                }
            }

            if (actionName === 'closeHistoryMenu') {
                // do nothing, because next code close this menu
            }

            // hide 'context menu'
            et.target.parentElement.style.display = "none";
        }

        async function readImportedProjectText(input) {
            try {
                var file = input.files[0];
                //var filename = file.name;
                var txt = await file.text();

                var lines = txt.split('\n');
                var _projectname = '';
                for (var index = 0; index < lines.length; index++) {
                    var line = lines[index];

                    if (line.includes('projectname:')) {

                        _projectname = (line.split('projectname:')[1]) ?? '';
                        if (_projectname !== '') {
                            // convert project name if we have project name which generates the same id.
                            _projectname = convertToExistingProjectName(_projectname);


                            if (arrProjects.indexOf(_projectname) < 0) {
                                arrProjects.push(_projectname);
                                var json_prj_str = JSON.stringify(arrProjects);
                                localStorage.setItem("wsmsprojects", json_prj_str);
                                reloadProjects();
                            }
                        } else {
                            wsAlert('This file does not have project. Please choose another file.')
                        }

                    } else
                        if (line.includes(':[')) {

                            var _key = line.split(':[')[0];
                            var _values = '[' + line.split(':[')[1];
                            if (localStorage.getItem(_key) === null) {
                                // import the whole list of wsmsservers because it is a new _key
                                localStorage.setItem(_key, _values);
                                if (_key.includes('wsmsservers')) {
                                    // reload Navigation actoss servers in left slide menu
                                    var _arr_new = JSON.parse(_values);
                                    reloaNavBy(_projectname, _arr_new);
                                }

                            } else {

                                // enrich existing _key by values from list of wsmsservers
                                var _arr_new = JSON.parse(_values);
                                var _existing_str = '[]';
                                if (localStorage.getItem(`${_key}`) !== null) {
                                    if (localStorage.getItem(`${_key}`) !== '') {
                                        _existing_str = localStorage.getItem(`${_key}`);
                                    }
                                }

                                var _arr_existing = JSON.parse(_existing_str);
                                _arr_new.forEach(element => {
                                    if (_arr_existing.indexOf(element) < 0) {
                                        _arr_existing.push(element);
                                    }
                                });

                                var json_merged_str = JSON.stringify(_arr_existing);
                                localStorage.setItem(_key, json_merged_str);

                                if (_key.includes('wsmsservers')) {
                                    // reload Navigation actoss servers in left slide menu
                                    reloaNavBy(_projectname, _arr_existing);
                                }
                            }
                        }
                }

            } catch (e) {
                console.log(e.message);
            }
        }

        async function readImportedHistoryText(input) {
            try {
                var file = input.files[0];
                //var filename = file.name;
                var txt = await file.text();

                var lines = txt.split('\n');
                var _projectname = '';
                for (var index = 0; index < lines.length; index++) {
                    var line = lines[index];

                    if (line.includes('projectname:')) {

                        _projectname = (line.split('projectname:')[1]) ?? '';
                        if (_projectname !== '') {
                            wsAlert('this is not history file! Please choose another file.')
                        }

                    } else
                        if (line.includes(':[')) {

                            var _key = line.split(':[')[0];
                            var _values = '[' + line.split(':[')[1];
                            if (localStorage.getItem(_key) === null) {
                                // import the whole list of wsmsservers because it is a new _key
                                localStorage.setItem(_key, _values);
                                if (_key.includes('wsmsservers')) {
                                    // reload Navigation actoss servers in left slide menu
                                    var _arr_new = JSON.parse(_values);
                                    reloaNavBy(_projectname, _arr_new);
                                }

                            } else {

                                // enrich existing _key by values from list of wsmsservers
                                var _arr_new = JSON.parse(_values);
                                var _existing_str = '[]';
                                if (localStorage.getItem(`${_key}`) !== null) {
                                    if (localStorage.getItem(`${_key}`) !== '') {
                                        _existing_str = localStorage.getItem(`${_key}`);
                                    }
                                }

                                var _arr_existing = JSON.parse(_existing_str);
                                _arr_new.forEach(element => {
                                    if (_arr_existing.indexOf(element) < 0) {
                                        _arr_existing.push(element);
                                    }
                                });

                                var json_merged_str = JSON.stringify(_arr_existing);
                                localStorage.setItem(_key, json_merged_str);

                                if (_key.includes('wsmsservers')) {
                                    // reload Navigation actoss servers in left slide menu
                                    reloaNavBy(_projectname, _arr_existing);
                                }
                            }
                        }
                }

            } catch (e) {
                console.log(e.message);
            }
        }

        function addProjectElement(wsproject) {
            var wsprojectname = document.createElement("p");
            wsprojectname.style.wordWrap = "break-word";
            wsprojectname.className = "wsprojectname"
            wsprojectname.onclick = chooseWsProject;
            wsprojectname.title = "Choose this WS server or press right button to open context menu and export this project";
            wsprojectname.innerHTML = `${wsproject}`;
            wsprojectname.oncontextmenu = openMenuProjectActions;

            var wsprojectmenu = document.createElement("p");
            wsprojectmenu.title = "project menu";
            wsprojectmenu.onclick = openMenuProjectActions;
            wsprojectmenu.oncontextmenu = openMenuProjectActions;
            wsprojectmenu.className = "wsprojectmenu";
            wsprojectmenu.innerHTML = "&nbsp;&brvbar;&nbsp;";

            var wsprojectrow = document.createElement("div");
            wsprojectrow.className = "wsprojectrow";
            wsprojectrow.appendChild(wsprojectname);
            wsprojectrow.appendChild(wsprojectmenu);

            var wsprojectsummary = document.createElement("summary");
            wsprojectsummary.className = "wssummary";
            wsprojectsummary.appendChild(wsprojectrow);

            var wsprojectserverslist = document.createElement("div");
            wsprojectserverslist.setAttribute("id", `${convertProjectNameToId(wsproject)}listWsServersHistory`);


            var wsprojectdetails = document.createElement("details");
            wsprojectdetails.setAttribute("id", `${convertProjectNameToId(wsproject)}`);
            wsprojectdetails.ontoggle = showProjectWsServers;
            wsprojectdetails.className = "wsproject";
            wsprojectdetails.appendChild(wsprojectsummary);
            wsprojectdetails.appendChild(wsprojectserverslist);

            const barSideProjectnav = document
                .getElementById('listWsProjects');
            barSideProjectnav.appendChild(wsprojectdetails);

            function showProjectWsServers() {
                var _wsProjectId = convertProjectNameToId(wsproject);
                var _arrNav = getArrWSserversBy(_wsProjectId) ?? [];
                reloaNavBy(wsproject, _arrNav);

            }

            function chooseWsProject() {
                var anotherproject = false;
                // if user choosed another server then close existing server
                if (wsproject !== wsProjectName) {
                    anotherproject = true;
                }
                wsProjectName = document.getElementById('nameProject').value = wsproject;

                if (anotherproject) {


                    setProjectId();
                    setArrHistory();
                    reloadHistory();
                    setArrWSservers();
                    reloaNav();
                    reloadQueries();
                    reloadHeads();

                } else {
                    setArrHistory();
                    reloadHistory();
                    reloadQueries();
                    reloadHeads();
                }
                // close lefyt slide menu
                closeNav();
            }

            function openMenuProjectActions(e) {

                e.preventDefault();

                var menu = document.getElementById("menuProjectActions");

                // close other elements with class "dropdownmenu"
                closeDropDownLists(menu.id);

                // add title in itmes of menu according to target (target here is souce of event)
                var _wsprojectname = wsproject; // e.target.innerHTML;
                document.getElementById("addWStoProject").title = _wsprojectname ?? '';
                document.getElementById("renameProject").title = _wsprojectname ?? '';
                document.getElementById("exportProject").title = _wsprojectname ?? '';
                document.getElementById("removeProject").title = _wsprojectname ?? '';
                document.getElementById("closeProjectMenu").title = _wsprojectname ?? '';

                // write title of menu
                document.getElementById("namemenuProjectActions").innerHTML = _wsprojectname;

                // show 'context menu'
                if (e.pageX > (slideMenuWidth - 140))
                {
                    menu.style.left = (slideMenuWidth - 140) + "px";
                } else {
                    menu.style.left = e.pageX + "px";
                }
                menu.style.top = e.pageY + "px";
                menu.style.display = "block";
            }
        }

        function addWSserverElement(wsserver, wrprojectname) {

            var wsproject_id = convertProjectNameToId(wrprojectname) ?? '';
            var wshistname = document.createElement("p");
            wshistname.style.wordWrap = "break-word";
            wshistname.className = "wshistname"
            wshistname.onclick = chooseWsServer;
            wshistname.title = "click to choose";
            wshistname.setAttribute("prjname", wrprojectname);
            wshistname.innerHTML = `${wsserver}`;

            var wshistclose = document.createElement("p");
            wshistclose.title = "remove from history";
            wshistclose.onclick = removeWsServer;
            wshistclose.className = "wshistclose";
            wshistclose.setAttribute("prjname", wrprojectname);
            wshistclose.innerHTML = "&nbsp;&times;";

            var wshistrow = document.createElement("div");
            wshistrow.className = "wshistrow";
            wshistrow.appendChild(wshistname);
            wshistrow.appendChild(wshistclose);

            const barSidenav = document
                .getElementById(`${wsproject_id}listWsServersHistory`);
            barSidenav.appendChild(wshistrow);

            function chooseWsServer() {
                var _wsProjectName = this.getAttribute("prjname") ?? '';
                var anotherProject = false;
                if (wsProjectName !== _wsProjectName) {
                    anotherProject = true;
                }

                var anotherserver = false;
                // if user choosed another server then close existing server
                if (wsserver !== wsUri) {
                    closeConnect();
                    anotherserver = true;
                }
                wsUri = document.getElementById('nameServer').value = wsserver;




                if (anotherProject) {
                    wsProjectName = document.getElementById('nameProject').value = _wsProjectName;
                    setProjectId();
                    setArrHistory();
                    reloadHistory();
                    reloadQueries();
                    reloadHeads();
                } else {
                    setArrHistory();
                    reloadHistory();
                    reloadQueries();
                    reloadHeads();
                }

                if (anotherserver) {
                    reloadQueries();
                    reloadHeads();
                    reConnect();

                    localStorage.setItem("wsmsserveractive", wsUri);
                }
                // close left slide menu
                closeNav();
            }

            async function removeWsServer() {
                var result = await wsConfirm(`Want to delete WS server: "${wsserver}" ?`);
                if (result) {
                    var _wsProjectName = this.getAttribute("prjname") ?? '';
                    var anotherProject = false;
                    if (wsProjectName !== _wsProjectName) {
                        anotherProject = true;
                    }

                    if (anotherProject) {
                        var _wsProjectId = convertProjectNameToId(_wsProjectName);
                        var _arrNav = getArrWSserversBy(_wsProjectId) ?? [];
                        var indextoremove = _arrNav.indexOf(wsserver);
                        var newarrnav = [];
                        for (let index = 0; index < _arrNav.length; index++) {

                            if (index !== indextoremove) {
                                if (_arrNav[index] !== null) {
                                    newarrnav.push(_arrNav[index]);
                                }
                            }
                        }
                        _arrNav = newarrnav;
                        var json_nav_str = JSON.stringify(_arrNav);

                        localStorage.setItem(`${_wsProjectId}wsmsservers`, json_nav_str);
                        deleteWSParameters(_wsProjectName, wsserver, 'query');
                        deleteWSParameters(_wsProjectName, wsserver, 'head');
                        this.parentElement.remove();
                        reloaNavBy(_wsProjectName, _arrNav);

                    }
                    else {
                        var deleteactivews = false;
                        if (wsserver === wsUri) {
                            console.log('delete active');
                            deleteactivews = true;
                            closeConnect();
                        }
                        var _wsProjectId = convertProjectNameToId(_wsProjectName);
                        var _arrNav = getArrWSserversBy(_wsProjectId) ?? [];
                        var indextoremove = _arrNav.indexOf(wsserver);
                        if (indextoremove >= 0) {
                            var newarrnav = [];
                            for (let index = 0; index < _arrNav.length; index++) {

                                if (index !== indextoremove) {
                                    if (_arrNav[index] !== null) {
                                        newarrnav.push(_arrNav[index]);
                                    }
                                }
                            }
                            arrNav = newarrnav;

                            var json_nav_str = JSON.stringify(arrNav);
                            localStorage.setItem(`${_wsProjectId}wsmsservers`, json_nav_str);

                            if (deleteactivews) {
                                document.getElementById("nameServer").value = '';
                                wsUri = '';
                                localStorage.setItem("wsmsserveractive", wsUri);
                            }
                            deleteWSParameters(_wsProjectName, wsserver, 'query');
                            deleteWSParameters(_wsProjectName, wsserver, 'head');
                            reloaNav();
                            reloadQueries();
                            reloadHeads();
                            // close left slide menu 

                        }
                    }


                    closeNav();
                }
            }
        }

        function addToMessagesElement(message, color = 'black') {
            var pre = document.createElement("p");
            pre.style.wordWrap = "break-word";
            pre.style.color = `${color}`;
            pre.innerHTML = message;
            const outputDiv = document
                .getElementById('output');
            outputDiv.appendChild(pre);

        }

        function addToHistoryElement(message, color = 'black') {

            var histText = document.createElement("p");
            histText.style.wordWrap = "break-word";
            histText.style.color = `${color}`;
            histText.innerHTML = message;
            histText.className = "histText";
            histText.onclick = copyToMessage;

            var delbtn = document.createElement("p");
            delbtn.className = "histBtn";
            delbtn.title = "Delete message from history";
            delbtn.onclick = delMessageFromHistory;
            delbtn.innerHTML = "&times;";

            var histRow = document.createElement("div");
            histRow.className = "histRow";
            histRow.appendChild(histText);
            histRow.appendChild(delbtn);

            const historyDiv = document
                .getElementById('history');
            historyDiv.appendChild(histRow);

            function copyToMessage() {
                var messageInput = document
                    .getElementById('messageInput');
                messageInput.value = message;
            }

            async function delMessageFromHistory() {

                var result = await wsConfirm(`Want to delete from history: "${message}" ?`);
                if (result) {
                    if (arr.indexOf(message) >= 0) {
                        var indextoremove = arr.indexOf(message);
                        var newarr = [];
                        for (let index = 0; index < arr.length; index++) {
                            var element = arr[index];
                            if (indextoremove !== index) {
                                newarr.push(element);
                            }
                        }
                        arr = newarr;
                        var json_str = JSON.stringify(arr);
                        localStorage.setItem(`${wsProjectId}wsmshistory`, json_str);
                        reloadHistory()

                    }
                }
            }
        }

        function addToParametersElement(_partype, _nameval) {

            var _parname = _nameval.split('::')[0] ?? '';
            var _parval = _nameval.split('::')[1] ?? '';

            var parType = document.createElement("div");
            parType.style.wordWrap = "break-word";
            parType.style.color = `dimgray`;
            parType.innerHTML = _partype;

            var parName = document.createElement("div");
            parName.style.wordWrap = "break-word";
            parName.style.color = `dimgray`;
            parName.innerHTML = _parname;

            var parVal = document.createElement("div");
            parVal.style.wordWrap = "break-word";
            parVal.style.color = `dimgray`;
            parVal.innerHTML = _parval;  
            
            var parAct = document.createElement("div");
            parAct.title = "Remove parameter";
            parAct.style.wordWrap = "break-word";
            parAct.style.color = `dimgray`;
            parAct.style.cursor = `pointer`;
            parAct.onclick = deleteParamVal;
            parAct.innerHTML = '&times;'; 

            const queryList = document.getElementById('queryList');
            queryList.appendChild(parType);
            queryList.appendChild(parName);
            queryList.appendChild(parVal);
            queryList.appendChild(parAct);

            async function deleteParamVal() {

                var result = await wsConfirm(`Want to delete parameter: "${_parname}" ?`);
                if (result) {
                    var _wsprojectid = convertProjectNameToId(wsProjectName) ?? '';
                    var _wsserverid = convertWsServerNameToId(wsUri) ?? '';
                    var arrparams = getArrWSParameters(wsProjectName, wsUri, _partype);
                    if (arrparams.indexOf(_nameval) >= 0) {
                        var indextoremove = arrparams.indexOf(_nameval);
                        var newarr = [];
                        for (let index = 0; index < arrparams.length; index++) {
                            var element = arrparams[index];
                            if (indextoremove !== index) {
                                newarr.push(element);
                            }
                        }
                        arrparams = newarr;
                        var json_str = JSON.stringify(arrparams);
                        localStorage.setItem(`${_wsprojectid}_${_wsserverid}_${_partype}`, json_str);
                        reloadQueries();
                        reloadHeads();

                    }
                }
            }

        }

        function reloadHeads() {
            const queryList = document.getElementById('headList');
            queryList.innerHTML = '';
            var arrHeads = getArrWSParameters(wsProjectName, wsUri, 'head') ?? [];
            arrHeads.forEach(_nameval => {
                addToParametersElement('head', _nameval);
            });
        }

        function reloadQueries() {
            const queryList = document.getElementById('queryList');
            queryList.innerHTML = '';
            var arrQueries = getArrWSParameters(wsProjectName, wsUri, 'query') ?? [];
            arrQueries.forEach(_nameval => {
                addToParametersElement('query', _nameval);
            });
        }

        function reloaNav() {
            document.getElementById(`${wsProjectId}listWsServersHistory`).innerHTML = '';
            arrNav.forEach((item) => {
                addWSserverElement(`${item}`, `${wsProjectName}`);
            })
        }

        function reloaNavBy(_wsProjectName, _arrNav) {
            var _wsProjectId = convertProjectNameToId(_wsProjectName) ?? '';
            if (document.getElementById(`${_wsProjectId}listWsServersHistory`) !== null) {
                document.getElementById(`${_wsProjectId}listWsServersHistory`).innerHTML = '';
                _arrNav.forEach((item) => {
                    addWSserverElement(`${item}`, `${_wsProjectName}`);
                })
            }


        }

        function reloadProjects() {
            document.getElementById('listWsProjects').innerHTML = '';
            arrProjects.forEach((item) => {
                addProjectElement(`${item}`);
            })
        }

        function openNav() {
            document.getElementById("barSideNav").style.width = `${slideMenuWidth}px`;

        }

        function closeNav() {
            document.getElementById("barSideNav").style.width = "0";
            closeDropDownLists('');
        }

        function reloadHistory() {
            document.getElementById('history').innerHTML = '';
            arr.forEach((item) => {
                console.log(item);
                addToHistoryElement(`${item}`, 'brown');
            })
        }

        function addWSParameter(_projectname, _wsserver, _paramtype, _paramname, _paramvalue) {
            var _wsProjectId = convertProjectNameToId(_projectname) ?? '';
            var _wsserverId = convertWsServerNameToId(_wsserver) ?? '';
            if (_wsserverId !== '') {
                var _namevalue = `${_paramname}::${_paramvalue}`;
                var _arrParams = [];
                var json_par_str = '[]';
                if (localStorage.getItem(`${_wsProjectId}_${_wsserverId}_${_paramtype}`) !== null) {
                    if (localStorage.getItem(`${_wsProjectId}_${_wsserverId}_${_paramtype}`) !== '') {
                        json_par_str = localStorage.getItem(`${_wsProjectId}_${_wsserverId}_${_paramtype}`);
                    }
                }

                var arrparams = JSON.parse(json_par_str);

                if (arrparams.indexOf(_namevalue) < 0) {
                    arrparams.push(_namevalue);
                    var json_new_str = JSON.stringify(arrparams);
                    localStorage.setItem(`${_wsProjectId}_${_wsserverId}_${_paramtype}`, json_new_str);
                }
            }
        }

        function getArrWSParameters(_projectname, _wsserver, _paramtype) {
            var arrparams = [];
            var _wsProjectId = convertProjectNameToId(_projectname) ?? '';
            var _wsserverId = convertWsServerNameToId(_wsserver) ?? '';
            if (_wsserverId !== '') {
                var json_par_str = '[]';
                if (localStorage.getItem(`${_wsProjectId}_${_wsserverId}_${_paramtype}`) !== null) {
                    if (localStorage.getItem(`${_wsProjectId}_${_wsserverId}_${_paramtype}`) !== '') {
                        json_par_str = localStorage.getItem(`${_wsProjectId}_${_wsserverId}_${_paramtype}`);
                    }
                }

                arrparams = JSON.parse(json_par_str);

            }
            return arrparams;
        }  

        function getKeyWSParameters(_projectname, _wsserver, _paramtype) {
            var _keywsparameters = '';
            var _wsProjectId = convertProjectNameToId(_projectname) ?? '';
            var _wsserverId = convertWsServerNameToId(_wsserver) ?? '';
            if (_wsserverId !== '') {
                _keywsparameters = `${_wsProjectId}_${_wsserverId}_${_paramtype}`;
            }
            return _keywsparameters;
        }          

        function deleteWSParameters(_projectname, _wsserver, _paramtype) {
            try {
                var _keywsparameters = getKeyWSParameters(_projectname, _wsserver, _paramtype) ?? '';
                if (_keywsparameters !== ''){
                    localStorage.removeItem(`${_keywsparameters}`);
                }
                
            } catch (error) {
                
            }

        }      

        function getParametersQueryString(_projectname, _wsserver) {
            var _stringquery = '';
            var arrqueries = getArrWSParameters(wsProjectName, wsUri, 'query') ?? [];
            arrqueries.forEach(_nameval => {
                var _parname = _nameval.split('::')[0] ?? '';
                var _parval = _nameval.split('::')[1] ?? '';
                if (_stringquery === '') {
                    _stringquery = `?${_parname}=${_parval}`;
                } else {
                     _stringquery = `${_stringquery}&${_parname}=${_parval}`;
                }
                
            });
            return _stringquery;
        }   
        
        function getHeadProtocols(_projectname, _wsserver) {
            var _arrheadprotocols = [];

            var _arrprotocols = getArrWSParameters(wsProjectName, wsUri, 'head') ?? [];
            _arrprotocols.forEach(_nameval => {
                var _parname = _nameval.split('::')[0] ?? '';
                var _parval = _nameval.split('::')[1] ?? '';
                if (_parname === 'Sec-WebSocket-Protocol') {
                    _protocol = `${_parval}`;
                    _arrheadprotocols.push(_protocol);
                } 
                
            });
            return _arrheadprotocols;
        } 

        function addParameters() {

            if (wsUri !== '') {
                var _namenewparameter = document.getElementById("nameNewParameter").value ?? '';
                var _valuenewparameter = document.getElementById("valueNewParameter").value ?? '';
                var _typenewparameter = document.getElementById("typeNewParameter").value ?? '';
                if ((_namenewparameter !== '')) {
                    addWSParameter(wsProjectName, wsUri, _typenewparameter, _namenewparameter, _valuenewparameter);
                    reloadQueries();
                    reloadHeads();
                } else {
                    wsAlert('Please fill in name of parameter. It is mandatory information.');
                }

            } else {
                wsAlert('Please point actual ws server!');
            }
        }

        function reConnect() {

            wsUri = document.getElementById("nameServer").value ?? '';
            try {

                var querystr = getParametersQueryString(wsProjectName, wsUri) ?? '';
                var arrheadprotocols = getHeadProtocols(wsProjectName, wsUri) ?? [];

                socket = new WebSocket(`${wsUri}${querystr}`, arrheadprotocols);

                socket.onopen = function (evt) {
                    onOpen(evt)
                };

                socket.onclose = function (evt) {
                    onClose(evt)
                };

                socket.onmessage = function (evt) {
                    onMessage(evt)
                };

                socket.onerror = function (evt) {
                    onError(evt)
                };

                addWSserver(wsProjectName, wsUri);

            } catch (error) {
                console.log(`connection to [${wsUri}] had exception...`)
            }

        }

        // Event listener for when 
        //the WebSocket connection is opened
        onOpen = function (event) {
            // Write message that users is 
            // connected to the WebSocket server
            addToMessagesElement(`You are Connected to Server "${wsUri}"`, 'green');

        };

        // Event listener for when a message
        //  is received from the server
        onMessage = function (event) {
            addToMessagesElement(`Response message: ${event.data}`, 'green');
        };

        // Event listener for when the 
        // WebSocket connection is closed
        onClose = function (event) {
            // Log a message when disconnected
            //  from the WebSocket server
            //console.log('Disconnected from WebSocket server');
            var _wsUriClosing = event.target.url ?? wsUriClosing;
            addToMessagesElement(`You are disconnected from Server "${_wsUriClosing}". Code: ${event.code} `, 'red');
        };

        // Event listener for when the 
        // WebSocket sending message had error
        onError = function (event) {
            addToMessagesElement(`It was error.`, 'red');
        };

        // Function to send a message
        //  to the WebSocket server
        function sendMessage() {
            // Get the message input element
            const messageInput = document
                .getElementById('messageInput');
            // Get the value of
            // the message input
            const message = messageInput.value;

            var _nameServer = (document.getElementById('nameServer').value ?? '').trim();

            if (socket.readyState === WebSocket.OPEN) {
                // Send the message to 
                // the WebSocket server			
                socket.send(message);
                // and show what we sent
                addToMessagesElement(`Sent message: ${message}`, 'blue');


                var nameProject = (document
                    .getElementById('nameProject').value ?? '').trim();
                if (nameProject !== '') {
                    if (arrProjects.indexOf(nameProject) < 0) {
                        arrProjects.push(nameProject);
                        var json_prj_str = JSON.stringify(arrProjects);
                        localStorage.setItem("wsmsprojects", json_prj_str);
                        setProjectId();
                        reloadProjects();
                        setArrHistory();
                        reloadHistory();
                        setArrWSservers();
                        reloaNav();
                        reloadQueries();
                        reloadHeads();
                    }
                } else {
                    if (wsProjectId != '') {
                        setProjectId();
                        setArrHistory();
                        reloadHistory();
                        setArrWSservers();
                        reloaNav();
                        reloadQueries();
                        reloadHeads();
                    }
                }



                if (arr.indexOf(message) < 0) {
                    arr.push(message);
                    var json_str = JSON.stringify(arr);
                    localStorage.setItem(`${wsProjectId}wsmshistory`, json_str);
                    addToHistoryElement(`${message}`, 'brown');
                }

                if (arrNav.indexOf(wsUri) < 0) {
                    arrNav.push(wsUri);
                    var json_nav_str = JSON.stringify(arrNav);
                    localStorage.setItem(`${wsProjectId}wsmsservers`, json_nav_str);
                    reloaNav();
                    reloadQueries();
                    reloadHeads();
                }

                localStorage.setItem("wsmsserveractive", wsUri);

                // Clear the message input
                messageInput.value = '';

            } else {
                wsAlert(`You can not send message at this moment. Because 'websocket client' is not connected to ws-server "${_nameServer}". Please press button <b>Reconnect</b> and then repeat sending your message.`)
            }
        }

        function changeProject() {

            // add new name of project to `wsprojects` and correct name if during add the proposed name has been changed.
            var _wsProjectName = (document.getElementById('nameProject').value ?? '').trim();
            document.getElementById('nameProject').value = wsProjectName = addProjectName(_wsProjectName);

            setProjectId();
            setArrProjects();
            setArrHistory();
            reloadHistory();
            reloadProjects();
            setArrWSservers();
            reloaNav();
            reloadQueries();
            reloadHeads();
        }

        function closeConnect() {
            if ((socket !== null) & (socket !== undefined)) {
                console.log(socket);
                if (socket.readyState === WebSocket.OPEN) {
                    try {
                        wsUriClosing = socket.url ?? '';
                        socket.close();
                    } catch (error) {
                        conslole.log('attempt to close non-existing web socket...');
                    }
                }
            }
        }

        function clearScreen() {

            document.getElementById("output").innerHTML = "";
        }


        initInputOfWeServer();
        setArrProjects();
        reConnect();
        setArrHistory();
        reloadHistory();
        reloadProjects();
        setArrWSservers();
        reloaNav();
        reloadQueries();
        reloadHeads();

    </script>

</body>

</html>